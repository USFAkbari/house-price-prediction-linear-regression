# تحلیل قیمت خانه‌ها با استفاده از رگرسیون خطی

## خلاصه پروژه

این پروژه با استفاده از رگرسیون خطی، قیمت دو خانه را که قیمت آن‌ها مشخص نبود، پیش‌بینی می‌کند و درصد تأثیر هر ویژگی را در قیمت محاسبه می‌نماید.

## ساختار پروژه

```
house-price-prediction-linear-regression/
├── تمرین سوم.xlsx          # داده‌های ورودی اصلی
├── predict_prices.py        # اسکریپت اصلی برای تحلیل و پیش‌بینی
├── extract_params.py        # اسکریپت استخراج پارامترهای مدل
├── create_excel_with_formulas.py  # اسکریپت ایجاد فایل اکسل با فرمول‌ها
├── results.xlsx             # نتایج پیش‌بینی و تحلیل (خروجی)
├── price_calculator.xlsx    # فایل اکسل با فرمول‌های محاسبه (خروجی)
├── model_params.json        # پارامترهای مدل (خروجی)
└── README.md               # این فایل
```

## داده‌های ورودی

- **تعداد خانه‌ها**: 10 خانه با قیمت مشخص + 2 خانه بدون قیمت
- **تعداد ویژگی‌ها**: 10 ویژگی
  - مساحت (Area)
  - تعداد اتاق‌ها (Rooms)
  - سن ساختمان (Age)
  - فاصله تا مرکز شهر (Distance-to-center)
  - پارکینگ (Parking)
  - طبقه (Floor)
  - آسانسور (Elevator)
  - نوساز (Renovated)
  - بالکن (Balcony)
  - چشم‌انداز (View)

## روش محاسبه قیمت‌ها

### 1. آماده‌سازی داده‌ها

#### الف) نرمال‌سازی (Standardization)
به دلیل اینکه ویژگی‌ها در مقیاس‌های متفاوتی هستند (مثلاً مساحت در متر مربع و تعداد اتاق‌ها)، از **StandardScaler** استفاده می‌شود:

```
X_scaled = (X - μ) / σ
```

که در آن:
- `μ` = میانگین هر ویژگی
- `σ` = انحراف معیار هر ویژگی

این کار باعث می‌شود تمام ویژگی‌ها در یک مقیاس یکسان قرار بگیرند و مقایسه ضرایب معنا پیدا کند.

#### ب) جداسازی داده‌ها
- **داده‌های آموزشی**: 10 خانه با قیمت مشخص
- **داده‌های تست**: 2 خانه بدون قیمت

### 2. مدل رگرسیون خطی

رگرسیون خطی رابطه بین ویژگی‌ها و قیمت را به صورت زیر مدل می‌کند:

```
Price = β₀ + β₁X₁ + β₂X₂ + ... + β₁₀X₁₀ + ε
```

که در آن:
- `Price` = قیمت خانه
- `β₀` = عرض از مبدأ (intercept) - قیمت پایه
- `β₁, β₂, ..., β₁₀` = ضرایب رگرسیون برای هر ویژگی
- `X₁, X₂, ..., X₁₀` = مقادیر نرمال‌سازی شده ویژگی‌ها
- `ε` = خطای مدل

### 3. محاسبه ضرایب (β)

ضرایب رگرسیون با استفاده از روش **کمترین مربعات (Ordinary Least Squares - OLS)** محاسبه می‌شوند:

```
β = (X^T · X)^(-1) · X^T · y
```

که در آن:
- `X` = ماتریس ویژگی‌های نرمال‌سازی شده
- `y` = بردار قیمت‌ها
- `β` = بردار ضرایب

این فرمول ضرایبی را پیدا می‌کند که مجموع مربعات خطاها را به حداقل برساند:

```
minimize: Σ(yᵢ - ŷᵢ)²
```

### 4. پیش‌بینی قیمت

برای پیش‌بینی قیمت یک خانه جدید:

```
ŷ = β₀ + β₁X₁ + β₂X₂ + ... + β₁₀X₁₀
```

**مثال محاسبه برای خانه اول (سطر 14):**

1. ویژگی‌های خانه:
   - مساحت: 140 متر مربع
   - اتاق: 3
   - سن: 6 سال
   - فاصله: 5.2 کیلومتر
   - پارکینگ: دارد (1)
   - طبقه: 4
   - آسانسور: دارد (1)
   - نوساز: بله (1)
   - بالکن: دارد (1)
   - چشم‌انداز: دارد (1)

2. نرمال‌سازی ویژگی‌ها:
   - هر ویژگی با استفاده از میانگین و انحراف معیار داده‌های آموزشی نرمال‌سازی می‌شود

3. محاسبه قیمت:
   ```
   Price = 3.64 + (3.05 × Area_scaled) + (-2.22 × Rooms_scaled) + ...
   ```

4. نتیجه: **5.36**

## منطق بدست آمدن ضرایب (β)

### چرا ضرایب این‌طور هستند؟

ضرایب رگرسیون نشان می‌دهند که **چقدر تغییر در یک ویژگی (بعد از نرمال‌سازی) باعث تغییر در قیمت می‌شود**.

#### تفسیر ضرایب:

1. **ضریب مثبت** (مثلاً Area: +3.05):
   - یعنی افزایش مساحت (نسبت به میانگین) باعث افزایش قیمت می‌شود
   - هر واحد افزایش در مساحت نرمال‌سازی شده، 3.05 واحد به قیمت اضافه می‌کند

2. **ضریب منفی** (مثلاً Rooms: -2.22):
   - یعنی افزایش تعداد اتاق‌ها (نسبت به میانگین) باعث کاهش قیمت می‌شود
   - این ممکن است به این دلیل باشد که در داده‌های موجود، خانه‌های بزرگ‌تر (با مساحت بیشتر) قیمت بالاتری دارند، و تعداد اتاق‌ها به تنهایی تأثیر منفی دارد

### چرا برخی ضرایب منفی هستند؟

این به دلیل **همبستگی بین ویژگی‌ها** است. برای مثال:
- اگر مساحت زیاد باشد، ممکن است تعداد اتاق‌ها نیز زیاد باشد
- مدل سعی می‌کند تأثیر مستقل هر ویژگی را پیدا کند
- اگر دو ویژگی همبستگی بالایی داشته باشند، ممکن است یکی از آن‌ها ضریب منفی بگیرد

### محاسبه ضرایب در کد:

```python
model = LinearRegression()
model.fit(X_train_scaled, y_train)
coefficients = model.coef_  # [β₁, β₂, ..., β₁₀]
intercept = model.intercept_  # β₀
```

## منطق بدست آمدن درصد تأثیر

### روش محاسبه:

درصد تأثیر هر ویژگی بر اساس **اهمیت مطلق ضرایب** محاسبه می‌شود:

```
اهمیت مطلق = |βᵢ|
```

سپس درصد تأثیر به صورت زیر محاسبه می‌شود:

```
درصد تأثیر ویژگی i = (|βᵢ| / Σ|βⱼ|) × 100
```

که در آن:
- `|βᵢ|` = قدر مطلق ضریب ویژگی i
- `Σ|βⱼ|` = مجموع قدر مطلق تمام ضرایب

### چرا از قدر مطلق استفاده می‌شود؟

- ما می‌خواهیم بدانیم **چقدر هر ویژگی مهم است**، نه اینکه تأثیر مثبت یا منفی دارد
- یک ضریب منفی بزرگ (مثلاً -2.22) به همان اندازه یک ضریب مثبت بزرگ (+2.22) مهم است
- بنابراین از قدر مطلق استفاده می‌کنیم تا فقط اندازه تأثیر را اندازه بگیریم

### مثال محاسبه:

فرض کنید ضرایب به صورت زیر هستند:
- Area: β₁ = 3.05
- Rooms: β₂ = -2.22
- Elevator: β₃ = 1.09
- ...

محاسبه درصد تأثیر:
```
|β₁| = |3.05| = 3.05
|β₂| = |-2.22| = 2.22
|β₃| = |1.09| = 1.09
...

مجموع = 3.05 + 2.22 + 1.09 + ... = 9.10

درصد تأثیر Area = (3.05 / 9.10) × 100 = 33.56%
درصد تأثیر Rooms = (2.22 / 9.10) × 100 = 24.40%
درصد تأثیر Elevator = (1.09 / 9.10) × 100 = 11.99%
...
```

### نتایج درصد تأثیر:

1. **مساحت (Area)**: 33.56% - بیشترین تأثیر
2. **تعداد اتاق‌ها (Rooms)**: 24.40%
3. **آسانسور (Elevator)**: 11.99%
4. **فاصله تا مرکز (Distance-to-center)**: 10.23%
5. **پارکینگ (Parking)**: 6.46%
6. **سن (Age)**: 3.31%
7. **طبقه (Floor)**: 2.80%
8. **بالکن (Balcony)**: 2.48%
9. **چشم‌انداز (View)**: 2.38%
10. **نوساز (Renovated)**: 2.38%

## توضیح منطقی قیمت‌های پیش‌بینی شده

### خانه 1 (قیمت: 5.36)

**ویژگی‌های کلیدی:**
- مساحت بالا (140 متر مربع) → +2.34 به قیمت
- سن کم (6 سال) → +0.26 به قیمت
- نزدیک به مرکز (5.2 کیلومتر) → -0.62 (اما چون نزدیک است، تأثیر مثبت دارد)
- امکانات کامل (پارکینگ، آسانسور، نوساز، بالکن، چشم‌انداز) → +1.64 به قیمت

**نتیجه**: قیمت بالا (5.36) به دلیل مساحت زیاد، سن کم، و امکانات کامل

### خانه 2 (قیمت: 1.78)

**ویژگی‌های کلیدی:**
- مساحت کم (70 متر مربع) → -2.70 به قیمت
- سن بالا (22 سال) → -0.30 به قیمت
- دور از مرکز (11 کیلومتر) → +0.88 (اما چون دور است، تأثیر منفی دارد)
- بدون امکانات → -2.61 به قیمت

**نتیجه**: قیمت پایین (1.78) به دلیل مساحت کم، سن بالا، دوری از مرکز، و نبود امکانات

## نحوه اجرا

### اجرای تحلیل اصلی

```bash
# اجرای اسکریپت اصلی برای پیش‌بینی قیمت و تحلیل
python predict_prices.py
```

این دستور:
- داده‌ها را می‌خواند و پاک‌سازی می‌کند
- مدل رگرسیون خطی را آموزش می‌دهد
- قیمت‌های پیش‌بینی شده را محاسبه می‌کند
- نتایج را در فایل `results.xlsx` ذخیره می‌کند

### ایجاد فایل اکسل با فرمول‌ها

```bash
# استخراج پارامترهای مدل
python extract_params.py

# ایجاد فایل اکسل با فرمول‌های محاسبه
python create_excel_with_formulas.py
```

این دستورات:
- پارامترهای مدل (ضرایب، intercept، میانگین، انحراف معیار) را استخراج می‌کنند
- فایل `price_calculator.xlsx` را با فرمول‌های Excel ایجاد می‌کنند
- امکان محاسبه قیمت برای مقادیر جدید را بدون نیاز به اجرای مجدد Python فراهم می‌کنند

## فایل‌های خروجی

1. **results.xlsx**: شامل دو شیت
   - شیت "نتایج پیش‌بینی": داده‌های اصلی با قیمت‌های پیش‌بینی شده
   - شیت "تحلیل ویژگی‌ها": جدول درصد تأثیر هر ویژگی

2. **price_calculator.xlsx**: فایل اکسل با فرمول‌های محاسبه قیمت
   - این فایل امکان محاسبه قیمت برای مقادیر جدید را با استفاده از فرمول‌های Excel فراهم می‌کند
   - شامل دو شیت:
     - **شیت "محاسبه قیمت"**: برای وارد کردن مقادیر جدید و محاسبه خودکار قیمت
     - **شیت "پارامترهای مدل"**: مرجع پارامترهای مدل (میانگین، انحراف معیار، ضرایب)

## استفاده از فایل اکسل با فرمول‌ها

### ایجاد فایل اکسل با فرمول‌ها

برای ایجاد فایل اکسل که شامل فرمول‌های محاسبه قیمت است:

```bash
# استخراج پارامترهای مدل
python extract_params.py

# ایجاد فایل اکسل با فرمول‌ها
python create_excel_with_formulas.py
```

این دستورات دو فایل ایجاد می‌کنند:
- `model_params.json`: پارامترهای مدل (ضرایب، intercept، میانگین، انحراف معیار)
- `price_calculator.xlsx`: فایل اکسل با فرمول‌های محاسبه

### نحوه استفاده از price_calculator.xlsx

1. **باز کردن فایل**: فایل `price_calculator.xlsx` را در Excel یا LibreOffice باز کنید.

2. **وارد کردن مقادیر**: در شیت "محاسبه قیمت"، مقادیر ویژگی‌ها را در ستون B (مقدار ورودی) وارد کنید:
   - مساحت (Area): به متر مربع
   - تعداد اتاق‌ها (Rooms): عدد صحیح
   - سن ساختمان (Age): به سال
   - فاصله تا مرکز (Distance-to-center): به کیلومتر
   - پارکینگ (Parking): 1 برای دارد، 0 برای ندارد
   - طبقه (Floor): شماره طبقه
   - آسانسور (Elevator): 1 برای دارد، 0 برای ندارد
   - نوساز (Renovated): 1 برای بله، 0 برای خیر
   - بالکن (Balcony): 1 برای دارد، 0 برای ندارد
   - چشم‌انداز (View): 1 برای دارد، 0 برای ندارد

3. **محاسبه خودکار**: قیمت به صورت خودکار در ردیف پایین (ردیف 14) محاسبه می‌شود.

### ساختار فرمول‌ها در Excel

#### فرمول نرمال‌سازی (ستون E):
```
=(B2-C2)/D2
```
که در آن:
- B2: مقدار ورودی
- C2: میانگین
- D2: انحراف معیار

#### فرمول تأثیر هر ویژگی (ستون G):
```
=F2*E2
```
که در آن:
- F2: ضریب رگرسیون
- E2: مقدار نرمال‌سازی شده

#### فرمول قیمت نهایی:
```
=Intercept + SUM(همه مقادیر ستون G)
```

### مزایای استفاده از فایل اکسل با فرمول‌ها

- **محاسبه خودکار**: با تغییر مقادیر ورودی، قیمت به صورت خودکار به‌روزرسانی می‌شود
- **قابل استفاده مجدد**: می‌توانید برای هر تعداد خانه جدید استفاده کنید
- **شفافیت**: تمام مراحل محاسبه (نرمال‌سازی، ضرب ضرایب) قابل مشاهده است
- **بدون نیاز به Python**: می‌توانید مستقیماً در Excel استفاده کنید

## محدودیت‌ها و نکات مهم

1. **R² Score = 1.0**: این نشان می‌دهد که مدل به طور کامل داده‌های آموزشی را پیش‌بینی می‌کند. این ممکن است به دلیل تعداد کم داده‌های آموزشی (10 نمونه) و تعداد زیاد ویژگی‌ها (10 ویژگی) باشد که می‌تواند منجر به **overfitting** شود.

2. **ضرایب منفی**: برخی ضرایب منفی هستند (مثلاً Rooms). این به دلیل همبستگی بین ویژگی‌ها است و لزوماً به معنای این نیست که تعداد اتاق‌ها همیشه قیمت را کاهش می‌دهد.

3. **داده‌های محدود**: با 10 نمونه آموزشی، مدل ممکن است برای داده‌های جدید به خوبی عمل نکند. برای مدل قوی‌تر، به داده‌های بیشتری نیاز است.

## منابع و مراجع

- رگرسیون خطی: [scikit-learn Linear Regression](https://scikit-learn.org/stable/modules/linear_model.html#ordinary-least-squares)
- نرمال‌سازی: [StandardScaler](https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html)
- روش کمترین مربعات: [OLS Method](https://en.wikipedia.org/wiki/Ordinary_least_squares)

